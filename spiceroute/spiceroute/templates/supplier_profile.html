{% extends 'base.html' %}

{% block title %}My Profile - SpiceRoute{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-success mb-4">My Profile & Vendor Reviews</h2>
    <p class="lead">Manage your public profile and view feedback from vendors.</p>

    <!-- MSH Profile Section -->
    <div class="card mb-5 shadow-sm rounded-3">
        <div class="card-header bg-success text-white rounded-top-3">
            <h5 class="mb-0">My Business Profile</h5>
        </div>
        <div class="card-body p-4">
            <form method="POST" action="{% url 'supplier_profile' %}">
                {% csrf_token %}
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="businessName" class="form-label">Business Name</label>
                        <input type="text" class="form-control rounded-pill" id="businessName" name="business_name" value="{{ supplier_profile.business_name }}" required>
                    </div>
                    <div class="col-md-6">
                        <label for="contactPerson" class="form-label">Contact Person</label>
                        <input type="text" class="form-control rounded-pill" id="contactPerson" name="contact_person" value="{{ supplier_profile.contact_person }}" required>
                    </div>
                    <div class="col-md-6">
                        <label for="phoneNumber" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control rounded-pill" id="phoneNumber" name="phone_number" value="{{ supplier_profile.phone_number }}" required>
                    </div>
                    <div class="col-md-6">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control rounded-pill" id="email" name="email" value="{{ supplier_profile.email|default_if_none:'' }}">
                    </div>
                    <div class="col-md-6">
                        <label for="locationPincode" class="form-label">Location Pincode</label>
                        <input type="text" class="form-control rounded-pill" id="locationPincode" name="location_pincode" value="{{ supplier_profile.location_pincode }}" required>
                    </div>
                    <div class="col-md-6">
                        <label for="storageCapacity" class="form-label">Storage Capacity (sq. ft.) (Optional)</label>
                        <input type="number" class="form-control rounded-pill" id="storageCapacity" name="storage_capacity_sqft" value="{{ supplier_profile.storage_capacity_sqft|default_if_none:'' }}" min="0">
                    </div>
                    <div class="col-md-12">
                        <label for="locationAddress" class="form-label">Full Address</label>
                        <textarea class="form-control rounded-3" id="locationAddress" name="location_address" rows="3" required>{{ supplier_profile.location_address }}</textarea>
                    </div>
                    <div class="col-md-12">
                        <label for="businessRegistrationDetails" class="form-label">Business Registration Details (Optional)</label>
                        <textarea class="form-control rounded-3" id="businessRegistrationDetails" name="business_registration_details" rows="3">{{ supplier_profile.business_registration_details|default_if_none:'' }}</textarea>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-100 mt-4 rounded-pill">Update Profile</button>
            </form>
        </div>
    </div>

    <!-- Vendor Reviews Section -->
    <div class="card shadow-sm rounded-3">
        <div class="card-header bg-info text-white rounded-top-3">
            <h5 class="mb-0">Vendor Reviews (Overall Rating: {{ supplier_profile.average_rating|floatformat:1 }}/5.0 - {{ supplier_profile.total_reviews }} reviews)</h5>
        </div>
        <div class="card-body p-0">
            {% if vendor_reviews %}
            <div class="list-group list-group-flush">
                {% for review in vendor_reviews %}
                <div class="list-group-item p-4">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">{{ review.reviewer_vendor.name }}</h6>
                        <small class="text-muted">{{ review.review_date|date:"d M Y" }}</small>
                    </div>
                    <div class="mb-2">
                        {% for _ in ""|ljust:review.rating %}
                            <i class="fas fa-star text-warning"></i>
                        {% endfor %}
                        {% for _ in ""|ljust:5|slice:review.rating %}
                            <i class="far fa-star text-warning"></i>
                        {% endfor %}
                        <span class="ms-2 text-muted">({{ review.rating }}/5)</span>
                    </div>
                    <p class="mb-1">{{ review.comment|default:"No comment provided." }}</p>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="p-4 text-center text-muted">No vendor reviews received yet.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
